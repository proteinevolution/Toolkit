#!/usr/bin/env bash

# Copyright (C) 2009-2017 Lightbend Inc. <https://www.lightbend.com>
# https://github.com/playframework/playframework/blob/master/framework/bin/validate-code

set -e
set -o pipefail

runSbt() {
  $SBT_BIN --warn 'set concurrentRestrictions in Global += Tags.limitAll(1)' "$@" | grep --line-buffered -v 'Resolving \|Generating '
}

runSbt scalafmt
git diff --exit-code || (
  echo "ERROR: Scalafmt check failed, see differences above."
  echo "To fix, format your sources using sbt scalafmt before submitting a pull request."
  echo "Additionally, please squash your commits (eg, use git commit --amend) if you're going to update this pull request."
  false
)
