
@import play.api.mvc.RequestHeader
<style>

textarea.reformatInput {
    width: 100%;
    height: 220px;
    border: 3px solid #cccccc;
    padding: 5px;
    font-size: 0.625em;
    font-family: Droid Sans Mono, sans-serif;

}

textarea#reformatOutput {
    width: 100%;
    height: 220px;
    border: 3px solid #cccccc;
    padding: 5px;
    font-size: 0.625em;
    font-family: Droid Sans Mono, sans-serif;

}


</style>


<div style="padding-top: 10px;"></div>
<h4>Alnviz</h4>
<p></p>
<textarea id="sequences" name="sequences" class="reformatInput"></textarea>





    <div class="large-12 row" style="float: left; display: flex">

        <button class="secondary button" onclick="initMSA()">View Alignment </button>
        <div class="large-5 row" id="yourDiv"></div>

    </div>



    <script src="@routes.Assets.at("javascripts/reformat.js")" type="text/javascript"></script>
    <script>

        var seq = ">gi|119391784|emb| \n CAJPECEADGIIQSVNWGTPGLSNEGLVIGFNVLLETGRHVAANNISQTLMEELTANAKEHGEDYYNGWACQVAYMEETSDGSLRHPSFVMFR \n >gi|72527918|gb|AAZ7297 \n PSEEADGHVVRPVWGTEGLANEGMVIGFDVMLENGMEVSATNISRALMSEFTENVKSDPDYYKGWACQITYMEETPDGSLRHPSFDQWR\n >gi|72527918|gb|AAZ7297 \n PSEEAGHVVRPVWGTEGLANEGMVIGFDVMLENGMEVSATNISRALMSEFTENVKSDPDYYKGWACQITYMEETPDGSLRHPSFDQWR";

        function initMSA(){



            var opts = {colorscheme: {"scheme": "clustal"} ,  bootstrapMenu: true};

            opts.el = document.getElementById("yourDiv");
            opts.vis = {
                conserv: false,
                overviewbox: true,
                seqlogo: true,
                labels: true,
                labelName: true,
                labelId: false,
                labelPartition: false,
                labelCheckbox: false
            };
            opts.zoomer = {
                // Alignment viewer is not scrolling with 'alignmentWidth: "auto"', use fixed numbers instead or
                // use script for handling
             autoResize: true
            };
            opts.seqs = fasta2json(seq);
            //opts.seqs = fasta2json(document.getElementById("alignment").value)
            var ms = new msa.msa(opts);


            // call render at the end to display the whole MSA
            ms.render();

        }
        $(document).foundation();
</script>

    @*

    ############ Pattern search ##########



<link href="@routes.Assets.at("styles/reformat.css")" rel="stylesheet">
<link href="@routes.Assets.at("styles/reformat-common.css")" rel="stylesheet">


<div style="width: 80%; display: block; margin: auto;">

    <div class="row" style="padding-top: 10px;"></div>
    <h4>Pattern Search</h4>
    <p></p>

    <div  class="row collapse">
        <form class="large-12 columns" style="display: flex;">
            <div class="input-group" style="width: 34%;">
                <span style="border-top-left-radius: 10%; border-bottom-left-radius: 10%;" class="input-group-label">/</span>
                <input class="input-group-field" style="color: darkgrey;" id="regex" placeholder="Type regular expresssion" type="text">
                <span style="border-top-right-radius: 10%; border-bottom-right-radius : 10%;" class="input-group-label">/</span>
            </div>
            <div style="margin-left: 1em; width: 15%;">
                <input  type="text" id="flag" style="color: darkgrey;" placeholder="gmixXsuUAJ" />
                <i data-tooltip aria-haspopup="true"  title="" style="
                    position: relative;
                    z-index: 1;
                    left: 7.375em;
                    top: -2.938em;
                    color: lightgray;
                    cursor: pointer;
                    width: 0;" class="icon-white_question"></i>
            </div>
        <div style="margin-left: 1em;">
            <button class="button" onclick="search()">Search</button>
        </div>
        </form>
    </div>

    <div class="large-12 columns">
        <div id="inputMirror" style="width: 99%; border: 1px solid lightgray ;"></div>
    </div>
    <div class="large-12 columns">
        <div id="outputMirror" style="width: 99%; border: 1px solid lightgray ; padding-top: 8px;"></div>
    </div>
</div>

<p>&nbsp;</p>

<textarea id="outputarea" style="height: 1px; position: relative; top: -10000px; left: -10000px;"></textarea>
<script src="@routes.Assets.at("javascripts/reformat.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("scripts/validation.js")"></script>
<script>

        var inputFasta = ">gi|3330gi0828|ref|NP_877456#7 putative ATP-dependent DNA ligase [Bacteriophage phiKMV]\nPEITVDGRIVGYVMGKTG-KNVGRVVGYRVELEDGSTVAATGLSEEHIQLLTCAYLNAHI\nD---EAMPNYGRIVEVSAMERSAN-TLRHPSFSRFR\n>gi|114796395|emb|CAK25951#9 putative ATP-dependent DNA ligase [Bacteriophage LKD16]\nPSLAVEGIVVGFVMGKTG-ANVGKVVGYRVDLEDGTIVSATGLTRDRIEMLTTEAELLGG\nA-DHPGMADLGRVVEVTAMERSAN-TLRHPKFSRFR\n>gi|114796457|emb|CAK24995#5 putative DNA ligase [Bacteriophage LKA1]   E=4e-40 s/c=1.7\nPGFEADGTVIDYVWGDPDKANANKIVGFRVRLEDGAEVNATGLTQDQMACYTQSYHATAY\nEVGITQTIYIGRACRVSGMERTKDGSIRHPHFDGFR\n>gi|29366706|ref|NP_813751#8 putative DNA ligase [Pseudomonas phage gh-1]   gi|29243565\nPDDNEDGFIQDVIWGTKGLANEGKVIGFKVLLESGHVVNACKISRALMDEFTDTETRLPG\n-------YYKGHTAKVTFMERYPDGSLRHPSFDSFR\n>gi|68299729|ref|YP_249578#6 DNA ligase [Vibriophage VP4]   gi|66473268|gb|AAY46277.1|\nPEGEIDGTVVGVNWGTVGLANEGKVIGFQVLLENGVVVDANGITQEQMEEYTNLVYKTGH\nD-----DCFNGRPVQVKYMEKTPKGSLRHPSFQRWR\n>gi|77118174|ref|YP_338096#3 ligase [Enterobacteria phage K1F]   gi|72527918|gb|AAZ7297\nPSEEADGHVVRPVWGTEGLANEGMVIGFDVMLENGMEVSATNISRALMSEFTENVKSDP-\n------DYYKGWACQITYMEETPDGSLRHPSFDQWR\n>gi|17570796|ref|NP_523305#4 DNA ligase [Bacteriophage T3]   gi|118769|sp|P07717|DNLI_B\nPECEADGIIQGVNWGTEGLANEGKVIGFSVLLETGRLVDANNISRALMDEFTSNVKAHGE\nD------FYNGWACQVNYMEATPDGSLRHPSFEKFR\n>gi|119637753|ref|YP_91898#2 DNA ligase [Yersinia phage Berlin]   gi|119391784|emb|CAJ\nPECEADGIIQSVNWGTPGLSNEGLVIGFNVLLETGRHVAANNISQTLMEELTANAKEHGE\nD------YYNGWACQVAYMEETSDGSLRHPSFVMFR\n";
        //var inputFasta = "AGGA"

        var myCodeMirror = CodeMirror(document.getElementById("inputMirror"), {
            value: inputFasta,
            lineNumbers: false,
            mode:  "none",
            theme: "reformat"
        });

        myCodeMirror.setSize("100%", 300);


        var myCodeMirror2 = CodeMirror(document.getElementById("outputMirror"), {
            value: "",
            lineNumbers: false,
            readOnly: true,
            mode:  "javascript",
            theme: "reformat"
        });

        myCodeMirror2.setSize("100%", 300);


        function search() {


            var regex = document.getElementById("regex").value;
            var flag = document.getElementById("flag").value;
            var text = myCodeMirror.getValue();
            myCodeMirror2.setValue('');
            var p1 = new Promise(function(resolve, reject){
                if (!text) {
                    reject();
                }
                if (regex == "") {
                    reject();
                }
                var result = [], matches, split, reg, beginHit, endHit, tmp, lastBeginHit, lastEndHit;
                split = text.split('\n');
                // remove empty lines

                split = split.filter(Boolean);

                reg = new RegExp(regex, flag);
                if (reg != null) {

                    for (var i = 0; i < split.length; i++) {

                        if (split[i].match(reg) != null) {
                            beginHit = -2;
                            endHit = -2;

                            result += i + '\t\t\t';
                            matches = split[i].match(reg);

                            tmp = split[i];
                            lastBeginHit = 0;
                            lastEndHit = 0;
                            for (var j = 0; j < matches.length; j++) {
                                beginHit = tmp.indexOf(matches[j], endHit + 2);
                                endHit = tmp.indexOf(matches[j], endHit + 2) + matches[j].length - 1;
                                tmp = tmp.substring(0, beginHit) + '\'' + tmp.match(reg)[j] + '\'' + tmp.substring(endHit + 1);
                                lastBeginHit = beginHit;
                                lastEndHit = endHit;
                            }
                            result += tmp;
                            result += '\n';

                        }
                    }
                   resolve(result);
                }
            });

            p1.then(function(result) {
                myCodeMirror2.setValue(result);
            });


        }

        $(document).foundation();

</script>


  *@

@*

############ extracts IDs ##########
<style>

textarea.reformatInput {
width: 100%;
height: 220px;
border: 3px solid #cccccc;
padding: 5px;
font-size: 0.625em;
font-family: Droid Sans Mono, sans-serif;

}

textarea#reformatOutput {
width: 100%;
height: 220px;
border: 3px solid #cccccc;
padding: 5px;
font-size: 0.625em;
font-family: Droid Sans Mono, sans-serif;

}


</style>


<div style="padding-top: 10px;"></div>
<h4>ExtractIDs</h4>
<p></p>
<textarea id="sequences" name="sequences" class="reformatInput"></textarea>
<label>Output Format
<select id="output" name="output_format">
<option selected>Choose</option>
<option value="gis">Extract GIs</option>
<option value="acc">Extract Accession</option>
</select>
</label>

<textarea id="reformatOutput" disabled></textarea>

<script src="@routes.Assets.at("javascripts/reformat.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("scripts/validation.js")"></script>
<script>

var inputFasta = document.getElementById("sequences").value = ">gi|33300828|ref|NP_877456#7 putative ATP-dependent DNA ligase [Bacteriophage phiKMV]\nPEITVDGRIVGYVMGKTG-KNVGRVVGYRVELEDGSTVAATGLSEEHIQLLTCAYLNAHI\nD---EAMPNYGRIVEVSAMERSAN-TLRHPSFSRFR\n>gi|114796395|emb|CAK25951#9 putative ATP-dependent DNA ligase [Bacteriophage LKD16]\nPSLAVEGIVVGFVMGKTG-ANVGKVVGYRVDLEDGTIVSATGLTRDRIEMLTTEAELLGG\nA-DHPGMADLGRVVEVTAMERSAN-TLRHPKFSRFR\n>gi|114796457|emb|CAK24995#5 putative DNA ligase [Bacteriophage LKA1]   E=4e-40 s/c=1.7\nPGFEADGTVIDYVWGDPDKANANKIVGFRVRLEDGAEVNATGLTQDQMACYTQSYHATAY\nEVGITQTIYIGRACRVSGMERTKDGSIRHPHFDGFR\n>gi|29366706|ref|NP_813751#8 putative DNA ligase [Pseudomonas phage gh-1]   gi|29243565\nPDDNEDGFIQDVIWGTKGLANEGKVIGFKVLLESGHVVNACKISRALMDEFTDTETRLPG\n-------YYKGHTAKVTFMERYPDGSLRHPSFDSFR\n>gi|68299729|ref|YP_249578#6 DNA ligase [Vibriophage VP4]   gi|66473268|gb|AAY46277.1|\nPEGEIDGTVVGVNWGTVGLANEGKVIGFQVLLENGVVVDANGITQEQMEEYTNLVYKTGH\nD-----DCFNGRPVQVKYMEKTPKGSLRHPSFQRWR\n>gi|77118174|ref|YP_338096#3 ligase [Enterobacteria phage K1F]   gi|72527918|gb|AAZ7297\nPSEEADGHVVRPVWGTEGLANEGMVIGFDVMLENGMEVSATNISRALMSEFTENVKSDP-\n------DYYKGWACQITYMEETPDGSLRHPSFDQWR\n>gi|17570796|ref|NP_523305#4 DNA ligase [Bacteriophage T3]   gi|118769|sp|P07717|DNLI_B\nPECEADGIIQGVNWGTEGLANEGKVIGFSVLLETGRLVDANNISRALMDEFTSNVKAHGE\nD------FYNGWACQVNYMEATPDGSLRHPSFEKFR\n>gi|119637753|ref|YP_91898#2 DNA ligase [Yersinia phage Berlin]   gi|119391784|emb|CAJ\nPECEADGIIQSVNWGTPGLSNEGLVIGFNVLLETGRHVAANNISQTLMEELTANAKEHGE\nD------YYNGWACQVAYMEETSDGSLRHPSFVMFR\n";


document.getElementById("output").onchange = function() {
var currentVal = this.value;

if (currentVal == "gis" && validateFasta(document.getElementById("sequences").value)) {
document.getElementById("reformatOutput").value = getGIs(document.getElementById("sequences").value);
}

if (currentVal == "acc" && validateFasta(document.getElementById("sequences").value)) {
document.getElementById("reformatOutput").value = getAccessionversion(fasta2json(document.getElementById("sequences").value));
}
}

</script>

*@


