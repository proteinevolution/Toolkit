@import play.api.mvc.RequestHeader
@import models.tel.TEL
@import models.tools.ToolModel.PatSearch
@(tel : TEL, inputForm: Form[(String, String, String)])(implicit messages: Messages, request: RequestHeader)

<style>



.cm-s-reformat span.cm-string { font-weight: bold; color: red; }

</style>

<ul class="tabs" id="tabs" data-tabs>
    <li class="tabs-title is-active"><a href="#tab1" aria-selected="true">Search Sequence</a></li>
    <li class="tabs-title"><a href="#tab2" >Search Database</a></li>
</ul>

<div class="medium-12 columns">
    <div class="tabs-content" data-tabs-content="tabs">
        <div class="tabs-panel is-active" id="tab1">
            <form class="large-12 columns">
                <div style="display: flex;">
                    <div class="input-group" style="width: 39%;" >
                        <span style="border-top-left-radius: 10%; border-bottom-left-radius: 10%;" class="input-group-label">/</span>
                        <input class="input-group-field" style="color: darkgrey;" id="regex" placeholder="Enter regular expresssion" type="text">
                        <span style="border-top-right-radius: 10%; border-bottom-right-radius : 10%;" class="input-group-label">/</span>
                    </div>
                    <div style="margin-left: 1em; width: 19%;">
                        <input  type="text" id="flag" style="color: darkgrey;" placeholder="gmixXsuUAJ" />
                        <i data-tooltip aria-haspopup="true"  title="" style="
                            position: relative;
                            z-index: 1;
                            left: 7.375em;
                            top: -2.938em;
                            color: lightgray;
                            cursor: pointer;
                            width: 0;" class="icon-white_question"></i>
                    </div>
                    <div style="margin-left: 1em;">
                        <button class="button" onclick="search()">Search</button>
                    </div>
                </div>
            </form>
            <div class="large-12 columns">
                <div id="inputMirror" style="width: 99%; border: 1px solid lightgray ;"></div>
            </div>

            <div class="large-12 columns">
                <div id="outputMirror" style="width: 99%; border: 1px solid lightgray ; padding-top: 8px;"></div>
            </div>
        </div>
        <div class="tabs-panel" id="tab2">
            <div style="width: 80%">
                @helper.textarea(field = inputForm("inputpattern"), args = 'rows -> 1, 'cols -> 1,
                    '_label -> "",
                    'placeholder -> "Enter pattern",
                    'id -> "inputpattern", '_showConstraints -> false)

            <a onClick="$('#inputpattern').val(prosite_grammar_example());$('#format').val('fas')">Paste example alignment</a>

                @helper.select(
                    inputForm("type"),
                    helper.options(PatSearch.parameterValues("type").toList),
                    '_label -> "Select pattern type",
                    'id -> "type")

                @helper.select(
                    inputForm("standarddb"),
                    helper.options(tel.getSetParam("standarddb")),
                    '_label -> "Select Database",
                    'id -> "standarddb")
            </div>
        </div>
    </div>
</div>





<script src="@routes.Assets.at("javascripts/reformat.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("scripts/validation.js")"></script>
<script src='@routes.Assets.at("javascripts/sampleseqs.js")' type="text/javascript" ></script>
<script>

        $( document ).ready(function() {
        $("#submitbuttons").hide();
        });

        $('#tabs').on('change.zf.tabs', function() {

        if($('#tab1:visible').length){
        $("#submitbuttons").hide();
        }
        if($('#tab2:visible').length){
        $("#submitbuttons").show();
        }

        });


        var inputFasta = ">gi|3330gi0828|ref|NP_877456#7 putative ATP-dependent DNA ligase [Bacteriophage phiKMV]\nPEITVDGRIVGYVMGKTG-KNVGRVVGYRVELEDGSTVAATGLSEEHIQLLTCAYLNAHI\nD---EAMPNYGRIVEVSAMERSAN-TLRHPSFSRFR\n>gi|114796395|emb|CAK25951#9 putative ATP-dependent DNA ligase [Bacteriophage LKD16]\nPSLAVEGIVVGFVMGKTG-ANVGKVVGYRVDLEDGTIVSATGLTRDRIEMLTTEAELLGG\nA-DHPGMADLGRVVEVTAMERSAN-TLRHPKFSRFR\n>gi|114796457|emb|CAK24995#5 putative DNA ligase [Bacteriophage LKA1]   E=4e-40 s/c=1.7\nPGFEADGTVIDYVWGDPDKANANKIVGFRVRLEDGAEVNATGLTQDQMACYTQSYHATAY\nEVGITQTIYIGRACRVSGMERTKDGSIRHPHFDGFR\n>gi|29366706|ref|NP_813751#8 putative DNA ligase [Pseudomonas phage gh-1]   gi|29243565\nPDDNEDGFIQDVIWGTKGLANEGKVIGFKVLLESGHVVNACKISRALMDEFTDTETRLPG\n-------YYKGHTAKVTFMERYPDGSLRHPSFDSFR\n>gi|68299729|ref|YP_249578#6 DNA ligase [Vibriophage VP4]   gi|66473268|gb|AAY46277.1|\nPEGEIDGTVVGVNWGTVGLANEGKVIGFQVLLENGVVVDANGITQEQMEEYTNLVYKTGH\nD-----DCFNGRPVQVKYMEKTPKGSLRHPSFQRWR\n>gi|77118174|ref|YP_338096#3 ligase [Enterobacteria phage K1F]   gi|72527918|gb|AAZ7297\nPSEEADGHVVRPVWGTEGLANEGMVIGFDVMLENGMEVSATNISRALMSEFTENVKSDP-\n------DYYKGWACQITYMEETPDGSLRHPSFDQWR\n>gi|17570796|ref|NP_523305#4 DNA ligase [Bacteriophage T3]   gi|118769|sp|P07717|DNLI_B\nPECEADGIIQGVNWGTEGLANEGKVIGFSVLLETGRLVDANNISRALMDEFTSNVKAHGE\nD------FYNGWACQVNYMEATPDGSLRHPSFEKFR\n>gi|119637753|ref|YP_91898#2 DNA ligase [Yersinia phage Berlin]   gi|119391784|emb|CAJ\nPECEADGIIQSVNWGTPGLSNEGLVIGFNVLLETGRHVAANNISQTLMEELTANAKEHGE\nD------YYNGWACQVAYMEETSDGSLRHPSFVMFR\n";
        //var inputFasta = "AGGA"

        var myCodeMirror = CodeMirror(document.getElementById("inputMirror"), {
            value: inputFasta,
            lineNumbers: false,
            mode:  "none",
            theme: "reformat"
        });

        myCodeMirror.setSize("100%", 300);


        var myCodeMirror2 = CodeMirror(document.getElementById("outputMirror"), {
            value: "",
            lineNumbers: false,
            readOnly: true,
            mode:  "javascript",
            theme: "reformat"
        });

        myCodeMirror2.setSize("100%", 300);


        function search() {


            var regex = document.getElementById("regex").value;
            var flag = document.getElementById("flag").value;
            var text = myCodeMirror.getValue();
            myCodeMirror2.setValue('');

            var result = searchRegex(text, regex, flag);
            myCodeMirror2.setValue(result);

        }


    // forwarding
    if(localStorage.getItem("resultcookie") != null){
    myCodeMirror.setValue(localStorage.getItem("resultcookie"));
    localStorage.removeItem("resultcookie");
    }

</script>
