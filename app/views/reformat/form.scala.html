
<style>

    div#content {

        width: 100%;
        background-color: #d1d1d1 !important;
    }

    .sidebar {

        display: none;
    }

    .CodeMirror pre {

    font-family: Monaco, Consolas, "Lucida Console", monospace;
    font-size: 12px;

    }


</style>

<link href="@routes.Assets.at("styles/reformat.css")" rel="stylesheet">
<div style="padding-top: 10px;"></div>
<ul class="vertical menu" data-accordion-menu>
    <li>
        <a href="#" class="menu-icon"><i class="fi-list"></i> Reformat Converter</a>
        <ul class="menu horizontal nested">
            <li><a download="export.txt" class="download" onclick="downloadResult()">Export</a></li>
            <li><a onclick="alert(myCodeMirror2.getValue())">Upload</a></li>
            <li><a onclick="alert(myCodeMirror2.getValue())">AlignmentViewer</a></li>
            <li><a onclick="myCodeMirror.setValue('');myCodeMirror2.setValue('')">Clear</a></li>
        </ul>
    </li>
</ul>


<p>&nbsp;</p>

<div style="width: 95%; display: block; margin: auto;">
<div class="large-6 columns">
<div id="inputMirror" style="width: 100%;"></div>
</div>
<div class="large-6 columns">
<div id="outputMirror" style="width: 100%;"></div>
</div>
</div>
<p>&nbsp;</p>
<div class="success callout" id="fastacallout" data-closable="slide-out-right" style="width: 50%; display: block; margin: auto;">
    <p style="width: 80%; text-align: justify;">It looks as we found a FASTA formatted input. To which format do you want to convert it?</p>
    <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
        <span aria-hidden="true">&times;</span>
    </button>

    <label>Select Output Format
        <select id="outformat_fas">
            <option selected>Choose</option>
            <option value="a3m">A3M</option>
            <option value="clu">CLUSTAL</option>
        </select>
    </label>
</div>

<div class="primary callout" id="clustalcallout" data-closable="slide-out-right" style="width: 50%; display: none; margin: auto;">
    <p style="width: 80%; text-align: justify;">It looks as we found a CLUSTAL formatted input. To which format do you want to convert it?</p>
    <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
        <span aria-hidden="true">&times;</span>
    </button>

    <label>Select Output Format
        <select id="outformat_clu">
            <option selected>Choose</option>
            <option value="fas">FASTA</option>
            <option value="a3m">A3M</option>
        </select>
    </label>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>

<script src="@routes.Assets.at("javascripts/reformat.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("scripts/validation.js")"></script>
<script>

    var inputFasta = ">gi|33300828|ref|NP_877456#7 putative ATP-dependent DNA ligase [Bacteriophage phiKMV]\nPEITVDGRIVGYVMGKTG-KNVGRVVGYRVELEDGSTVAATGLSEEHIQLLTCAYLNAHI\nD---EAMPNYGRIVEVSAMERSAN-TLRHPSFSRFR\n>gi|114796395|emb|CAK25951#9 putative ATP-dependent DNA ligase [Bacteriophage LKD16]\nPSLAVEGIVVGFVMGKTG-ANVGKVVGYRVDLEDGTIVSATGLTRDRIEMLTTEAELLGG\nA-DHPGMADLGRVVEVTAMERSAN-TLRHPKFSRFR\n>gi|114796457|emb|CAK24995#5 putative DNA ligase [Bacteriophage LKA1]   E=4e-40 s/c=1.7\nPGFEADGTVIDYVWGDPDKANANKIVGFRVRLEDGAEVNATGLTQDQMACYTQSYHATAY\nEVGITQTIYIGRACRVSGMERTKDGSIRHPHFDGFR\n>gi|29366706|ref|NP_813751#8 putative DNA ligase [Pseudomonas phage gh-1]   gi|29243565\nPDDNEDGFIQDVIWGTKGLANEGKVIGFKVLLESGHVVNACKISRALMDEFTDTETRLPG\n-------YYKGHTAKVTFMERYPDGSLRHPSFDSFR\n>gi|68299729|ref|YP_249578#6 DNA ligase [Vibriophage VP4]   gi|66473268|gb|AAY46277.1|\nPEGEIDGTVVGVNWGTVGLANEGKVIGFQVLLENGVVVDANGITQEQMEEYTNLVYKTGH\nD-----DCFNGRPVQVKYMEKTPKGSLRHPSFQRWR\n>gi|77118174|ref|YP_338096#3 ligase [Enterobacteria phage K1F]   gi|72527918|gb|AAZ7297\nPSEEADGHVVRPVWGTEGLANEGMVIGFDVMLENGMEVSATNISRALMSEFTENVKSDP-\n------DYYKGWACQITYMEETPDGSLRHPSFDQWR\n>gi|17570796|ref|NP_523305#4 DNA ligase [Bacteriophage T3]   gi|118769|sp|P07717|DNLI_B\nPECEADGIIQGVNWGTEGLANEGKVIGFSVLLETGRLVDANNISRALMDEFTSNVKAHGE\nD------FYNGWACQVNYMEATPDGSLRHPSFEKFR\n>gi|119637753|ref|YP_91898#2 DNA ligase [Yersinia phage Berlin]   gi|119391784|emb|CAJ\nPECEADGIIQSVNWGTPGLSNEGLVIGFNVLLETGRHVAANNISQTLMEELTANAKEHGE\nD------YYNGWACQVAYMEETSDGSLRHPSFVMFR\n";
    // document.getElementById("alignment").value = inputFasta;
    var inputClustal = "CLUSTAL multiple sequence alignment\n\ngi|33300828\tPEITVDGRIVGYVMGKTG-KNVGRVVGYRVELEDGSTVAATGLSEEHIQLLTCAYLNAHI\ngi|11479639\tPSLAVEGIVVGFVMGKTG-ANVGKVVGYRVDLEDGTIVSATGLTRDRIEMLTTEAELLGG\ngi|11479645\tPGFEADGTVIDYVWGDPDKANANKIVGFRVRLEDGAEVNATGLTQDQMACYTQSYHATAY\ngi|29366706\tPDDNEDGFIQDVIWGTKGLANEGKVIGFKVLLESGHVVNACKISRALMDEFTDTETRLPG\ngi|68299729\tPEGEIDGTVVGVNWGTVGLANEGKVIGFQVLLENGVVVDANGITQEQMEEYTNLVYKTGH\ngi|77118174\tPSEEADGHVVRPVWGTEGLANEGMVIGFDVMLENGMEVSATNISRALMSEFTENVKSDP-\ngi|17570796\tPECEADGIIQGVNWGTEGLANEGKVIGFSVLLETGRLVDANNISRALMDEFTSNVKAHGE\ngi|11963775\tPECEADGIIQSVNWGTPGLSNEGLVIGFNVLLETGRHVAANNISQTLMEELTANAKEHGE\n\ngi|33300828\tD---EAMPNYGRIVEVSAMERSAN-TLRHPSFSRFR\ngi|11479639\tA-DHPGMADLGRVVEVTAMERSAN-TLRHPKFSRFR\ngi|11479645\tEVGITQTIYIGRACRVSGMERTKDGSIRHPHFDGFR\ngi|29366706\t-------YYKGHTAKVTFMERYPDGSLRHPSFDSFR\ngi|68299729\tD-----DCFNGRPVQVKYMEKTPKGSLRHPSFQRWR\ngi|77118174\t------DYYKGWACQITYMEETPDGSLRHPSFDQWR\ngi|17570796\tD------FYNGWACQVNYMEATPDGSLRHPSFEKFR\ngi|11963775\tD------YYNGWACQVAYMEETSDGSLRHPSFVMFR";



    var myCodeMirror = CodeMirror(document.getElementById("inputMirror"), {
    value: inputFasta,
    lineNumbers: false,
    mode:  "none",
    theme: "reformat"
    });

    myCodeMirror.setSize("100%", 500);


    var myCodeMirror2 = CodeMirror(document.getElementById("outputMirror"), {
    value: "",
    lineNumbers: false,
    readOnly: true,
    mode:  "javascript",
    theme: "reformat"
    });

    myCodeMirror2.setSize("100%", 500);



    // on and off handler like in jQuery
    myCodeMirror.on('change',function(cMirror){
        // get value right from instance
        if(validateFasta(myCodeMirror.getValue())) {
            document.getElementById('fastacallout').style.display = 'block';
        }

        if(!validateFasta(myCodeMirror.getValue())) {
            document.getElementById('fastacallout').style.display = 'none';
        }

        if(checkClustal(myCodeMirror.getValue())) {
            document.getElementById('clustalcallout').style.display = 'block';
        }
        if(!checkClustal(myCodeMirror.getValue())) {
            document.getElementById('clustalcallout').style.display = 'none';
        }

    });


    document.getElementById("outformat_fas").onchange = function() {
        var currentVal = this.value;

        if (currentVal == "a3m") {

            myCodeMirror2.setValue(readA3mText(myCodeMirror.getValue()));
        }

        if (currentVal == "clu") {
            myCodeMirror2.setValue(printClustalText(myCodeMirror.getValue()));
        }

    };

    document.getElementById("outformat_clu").onchange = function() {
        var currentVal = this.value;

        if (currentVal == "a3m") {

            myCodeMirror2.setValue(readA3mText(clustal2Fasta(myCodeMirror.getValue())));
        }

        if (currentVal == "fas") {
            myCodeMirror2.setValue(clustal2Fasta(myCodeMirror.getValue()));
        }

    };


    function downloadResult() {
        if (myCodeMirror2.getValue())
        $('a.download').attr('href', 'data:application/octet-stream;content-disposition:attachment;filename=file.txt;charset=utf-8,' + encodeURIComponent(myCodeMirror2.getValue()));
        }

    $(document).foundation();

</script>

