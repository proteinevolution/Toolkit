@import models.results.Ancescon
@(filename: String, treePath: String, jobID: String, iddiv: String)(implicit request: RequestHeader)


<select id="@{iddiv}_select" onchange="setLayout()">
        <option value="radial">Radial</option>
        <option value="vertical">Vertical</option>
    </select>
    <a type="button" onclick="@{iddiv}_download()" id="downloadAlignment">Download Newick Tree</a>
<hr id="line-element" colspan="4" class="horizontal-line">

<div id="@iddiv"></div>



<script>
    var s = $("#@{iddiv}_select");
    s.niceSelect();
    var downloadFilename = "@{iddiv}_@{jobID}";
    window["@{iddiv}_download"] = function(){
        var downloadFilename = "@{iddiv}_@{jobID}";
        var fileURL="/files/@{jobID}/@{filename}";
        $.ajax({
            method: "GET",
            url: fileURL
        }).done(function(data){
            download(downloadFilename, data);
        })
    };


    function setLayout() {

        var v = s.val();
        if(v == "radial") {

            tree.layout(radial_layout);

        } else {
            tree.layout(vertical_layout);
        }
        tree.update();
    }

   var parser = require("biojs-io-newick");
   var treelib =  biojs.vis.tree;
   var tree = treelib.tree();

  // Define the Layout
  var width = $("#tool-tabs").width() - 200;
  var vertical_layout = treelib.tree.layout.vertical();
  var radial_layout = treelib.tree.layout.radial();
  vertical_layout.width(width);
  vertical_layout.scale(true);
  vertical_layout.height(20);
  radial_layout.width(width);
  radial_layout.scale(false);

  tree.layout(radial_layout);
  tree.data(parser.parse_newick('@Ancescon.readTree(treePath)'));
  tree.on_click(function(node) {
      node.toggle();
      tree.update();
  });
  tree(document.getElementById("@iddiv"));

  function onFullscreenToggle() {

   var layout = tree.layout();
   layout.width($("#tool-tabs").width() - 900);
   document.getElementById("@iddiv").children[0].setAttribute('id', 'treeSvgContainer');
   tree.update();
  }

  function onCollapsescreen() {
      var layout = tree.layout();
      document.getElementById("@iddiv").children[0].removeAttribute('id');
      layout.width($("#tool-tabs").width() - 200);
      tree.update();
  }


</script>
