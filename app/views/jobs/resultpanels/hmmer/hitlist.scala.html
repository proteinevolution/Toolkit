@import de.proteinevolution.tools.results.Hmmer.HmmerResult
@import better.files._
@import play.twirl.api.Html
@(jobID: String, result: HmmerResult, tool: de.proteinevolution.models.Tool, htmlPath: String)()
@* Load html Map used for the image representation *@
    @if(result.num_hits < 1) {
        <div class="callout alert noHitsWide" id="noHits">
            No hits found!
        </div>
    } else {
    @* Loads ForwardModal *@
    @views.html.forwardmodals.normal(tool, tool.toolNameShort, "")
    <div class="scrollContainer scrollContainerWhite">
        <div class="scrollContainerDiv scrollContainerDivWhite">
            <div id="scrollLinks">
                <a id="visualizationScroll" name="#visualization" onclick="ResultViewHelper.scrollToSection('visualization')">Vis</a>
                <a id="hitlistScroll" name="#hitlist" onclick="ResultViewHelper.scrollToSection('hitlist')">Hits</a>
                <a id="alignmentsScroll" name="#alignments" onclick="ResultViewHelper.scrollToSection('alignments')">Aln</a>
            </div>
            <span class="headerDivider"></span>
            <div id="controlls">

                <a onclick="ResultViewHelper.toggleAllCheckboxes();" class="selectAllSeqBar" id="extraWide">Select all</a>
                <a type="button" id="forwardButtonNormal" data-open="forwardModal_@{
                    tool.toolNameShort
                }">Forward</a>
                <a onclick="ResultViewHelper.toggleIsWrapped(jobID, shownHits, numHits, wrapped, colorAAs); wrapped = !wrapped;" id="wrap">Wrap Seqs</a>
            </div>
        </div>
    </div>
    <br>
    <span class="notePlain">Number of hits: <b>@result.num_hits</b></span>
    <br>

    @if(result.TMPRED == "1" || result.TMPRED.toInt > 1 || result.COILPRED == "0"){
        <br>
        <span class="note"> We have detected</span>

    }
    @if(result.TMPRED == "1"){

        <span class="note"> @result.TMPRED transmembrane helix</span>
    }
    @if(result.TMPRED.toInt > 1){

        <span class="note"> @result.TMPRED transmembrane helices</span>
    }
    @if((result.TMPRED == "1" || result.TMPRED.toInt > 1) && result.COILPRED == "0"){
        <span class="note"> and </span>

    }
    @if(result.COILPRED == "0"){
        <span class="note">coiled-coil segments </span>
    }

    @if(result.TMPRED == "1" || result.TMPRED.toInt > 1 || result.COILPRED == "0"){
        <span class="note"> in your query protein!</span>

    }

    <div id="visualization">
        <h5 id="visualizationTitle">Visualization</h5>
        <div>
            <a class="success button tiny resubmitSection" onclick="HitsSlider.resubmit('@{result.query.seq}', '>' + '@{result.query.accession}')" type="button" id="resubmitSection">Resubmit section</a>
        </div>

        <div id='blastviz'>
            <div class='flat-slider' id='flat-slider'></div>
            @Html(htmlPath.toFile.contentAsString)
            <p><img src="files/@jobID/blastviz.png" border="0" alt="blasthits" usemap="#blastmap"></p>
        </div>
    </div>
    <div id="hitlist">
        <h5 id="hitlistTitle">Hitlist</h5>
        <table id="htb" class="display" width="100%">
            <thead>
                <tr>
                    <th>Nr</th>
                    <th>Id</th>
                    <th>Title</th>
                    <th>E-value</th>
                    <th>Ind. E-value</th>
                    <th>Bitscore</th>
                    <th>Aligned positions</th>
                </tr>
            </thead>
        </table>
    </div>

    <div id="alignmentResult">
        <div id="alignments">
            <h5 id="alignmentsTitle">Alignments</h5>
            <form id="hhpred_templates">
                <table class="unstriped">
                    <tbody id="alignmentTable">
                    </tbody>
                    <tr>
                        <td colspan="4" ><a onclick="getsHitsManually()" id="loadHits">Load Hits</a></td>
                    </tr>
                    <tr>
                        <td colspan="4"><div id="loadingHits">Loading Hits...</div></td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
    <br>
    <div id="toolReferences">
        <h5 id="refTitle">References</h5>
        If you use our HMMER server for your research, please cite:
        <div class="citation">
          @views.html.help.common.toolkit_citation_results()
	</div>
        And the HMMER paper:
        <div class="citation">
            <div>Accelerated Profile HMM Searches.<br>
                Eddy SR.<a href="http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002195" target="_blank" rel="noopener">  PLoS Comput Biol. 2011 Oct;7(10):e1002195</a>.</div>
        </div>
    </div>
    <hr class="horizontal-line">

}
<script>
        var checkbox = "checkbox";
        var shownHits = 50;
        var numHits = @{result.num_hits};
        var jobID = '@{jobID}';
        var loading = false;
        var wrapped = true;
        // use this array to store
        // checked checkboxes
        // due to pagination/lazyload
        var checkboxes = [];

        $(document).ready(function () {
            hitlistBaseFunctions();
            if (numHits > 0) {
                $("#wrap").text("Unwrap Seqs");
                $("#wrap").addClass("colorToggleBar");
                new DataTables("hmmer").config(jobID, numHits);
                var firstQueryStart = @{if(result.num_hits > 0){ result.HSPS.head.query_start}};
                var firstQueryEnd = @{if(result.num_hits > 0){ result.HSPS.head.query_end}};
                /* without timeout SLIDER is displayed */
                HitsSlider.show(@{result.query.seq.length}, firstQueryStart, firstQueryEnd);
                shownHits = shownHits > numHits ? numHits : shownHits;
                ResultViewHelper.showHits(0, shownHits, wrapped, false, numHits, jobID);
                $("#wrap").hide();
            }
        });
</script>
