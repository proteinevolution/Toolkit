@import play.api.mvc.RequestHeader
@import scala.io.Source
@(jobID : String, filePath: String)(implicit request: RequestHeader)
<br/>
<div id="menuDivItem"></div>
<div id="rootDiv">Loading ... </div>

<script>
    var alignmentItem;

    $(document).ready(function () {
        var seqs = '';
        var width, height, defMenu,  menuOpts;
        var opts = {colorscheme: {"scheme": "clustal"}};

        @for(line <-  Source.fromFile(filePath).getLines) {
        seqs += '@{line}\n';
        }

        seqs = msa.io.clustal.parse(seqs);
        msa = require("msa");

        if ($('#tool-tabs').hasClass('fullscreen')) {
            height = $(window).height() - 180;
        } else {
            height = $('#tool-tabs').width() - 500;
        }

        width = $('#tool-tabs').width() - 240;

        if (!seqs) {
            return;
        }

        opts.el = document.getElementById("rootDiv");
        opts.seqs = seqs;
        opts.vis = {
            conserv: false,
            overviewbox: false,
            seqlogo: false,
            labels: true,
            labelName: true,
            labelId: false,
            labelPartition: false,
            labelCheckbox: false
        };
        opts.conf = {
            dropImport: true
        };
        opts.zoomer = {
            // Alignment viewer is not scrolling with 'alignmentWidth: "auto"', use fixed numbers instead or
            // use script for handling
            alignmentHeight: height,
            alignmentWidth: width,
            labelNameLength: 165,
            labelWidth: 85,
            labelFontsize: "13px",
            labelIdLength: 75,
            menuFontsize: "12px",
            menuMarginLeft: "2px",
            menuPadding: "0px 10px 0px 0px",
            menuItemFontsize: "14px",
            menuItemLineHeight: "14px",
            autoResize: false
        };
        alignmentItem = new msa.msa(opts);
        menuOpts = {
            el : document.getElementById('menuDivItem'),
            msa : alignmentItem
        };
        defMenu = new msa.menu.defaultmenu(menuOpts);
        alignmentItem.addView('menu', defMenu);

        alignmentItem.render();
        //hide unsused options
        $('#menuDivItem').children().eq(5).hide();
        $('#menuDivItem').children().eq(6).hide();

        $(window).bind("resize.MSAViewerClustal", function(){
            if($("#rootDiv").parents("html").length === 0){
                $(window).unbind("resize.MSAViewerClustal");
                return;
            }
            alignmentItem.g.zoomer.set("alignmentWidth", $('#tool-tabs').width() - 240);
            if($('#tool-tabs').hasClass('fullscreen')) {
                alignmentItem.g.zoomer.set("alignmentHeight", Math.max(400, $(window).height() - 180));
            }
        });
    });

    function onFullscreenToggle() {
        alignmentItem.g.zoomer.set("alignmentHeight", $(window).height() - 180);
        alignmentItem.g.zoomer.set("alignmentWidth",  $('#tool-tabs').width() - 240);
    }

    function onCollapsescreen() {
        alignmentItem.g.zoomer.set("alignmentHeight", $('#tool-tabs').width() - 500);
        alignmentItem.g.zoomer.set("alignmentWidth", $('#tool-tabs').width() - 240);
    }

</script>
