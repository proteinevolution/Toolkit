@import play.api.libs.json.JsObject
@import play.api.libs.json.JsValue
@import play.api.libs.json.JsArray
@import play.api.Logger
@import models.results.FileLoader
@import play.api.libs.json.JsUndefined
@import play.api.libs.json.JsDefined
@import models.results.BlastVisualization
@import modules.tel.TEL
@import play.api.libs.json.JsLookupResult
@(jobID: String, jsValue: JsValue, resultName: String,  tool : models.tools.Tool)(implicit request: RequestHeader)
<link href="@routes.Assets.versioned("styles/blast-visualization.css")" rel="stylesheet">

@views.html.forwardmodals.simpler(tool, resultName)

<div class="colorOptsAlignment">
    <a onclick='alignment_wrap()' type="button"><span id="wrap_@{resultName}">Wrap sequences</span></a>
    <a type="button" data-open="forwardModal_@resultName"><span>Forward All</span></a>
    <a type="button" id="downloadAlignment"  onclick="alignment_download()"><span>Download File</span></a>
    <hr id="line-element" colspan="4" class="horizontal-line">
</div>
<div id="alignmentResultView">
    Number of sequences: @{{jsValue \ resultName}.as[List[JsArray]].size}
        <br />
        <br />
<form id="alignmentResult">
    <table class="unstriped">
        <tbody class="alignmentTBody">
        @for((alignment,index) <- {jsValue \ resultName}.as[List[JsArray]].zipWithIndex) {
            <tr class="header">
                <td>
                    @{alignment{0} match {
                        case JsDefined(jsValue) => ">"+(alignment{0}).get.as[String]
                        }
                    }
                </td>
            </tr>
            <tr class="sequenceAlignment">
                <td>
                    @{alignment{1} match {
                        case JsDefined(jsValue) => Html((alignment{1}).get.as[String].replace("-", "&#8209;"))
                        }
                    }
                </td>
            </tr>
        }
            <tr><td><br/></td></tr>
            <tr><td><br/></td></tr>
        </tbody>
    </table>

</form>
</div>

<script>
        var fileUrl = "/files/@jobID/alignment.fas";
        var downloadFilename = "@{tool.toolNameShort}_@{resultName}_jobID_@{jobID}.fasta";
        var selectAllBool_@{resultName} = false;
        var wrapSequencesBool_@{resultName} = false;
        $(document).ready(function () {
            $("#alignmentResult").floatingScroll();
        });


        function alignment_wrap(){
            this.wrapSequencesBool_@{resultName} = !this.wrapSequencesBool_@{resultName};
            if(wrapSequencesBool_@{resultName}) {
                $(".sequenceAlignment").addClass("wrap");
                $("#wrap_@{resultName}").addClass("colorToggle");
            }
            else {
                $(".sequenceAlignment").removeClass("wrap");
                $("#wrap_@{resultName}").removeClass("colorToggle");
            }
        }


        function alignment_forward(selectedTool){
            // get result json
            $.ajax({
                type: 'GET',
                url: fileUrl
            }).done(function (data) {
                    forward(selectedTool, data);
            });
        }


        function alignment_download(){
            // get result json
            $.ajax({
                type: 'GET',
                url: fileUrl
            }).done(function (data) {
                download(downloadFilename, data.toString());
            });
        }

</script>
