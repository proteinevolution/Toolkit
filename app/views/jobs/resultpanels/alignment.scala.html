@import play.api.libs.json.JsObject
@import play.api.libs.json.JsValue
@import play.api.libs.json.JsArray
@import play.api.Logger
@import models.results.FileLoader
@import play.api.libs.json.JsUndefined
@import play.api.libs.json.JsDefined
@import models.results.BlastVisualization
@import modules.tel.TEL
@(jobID: String, jsValue: JsValue)(implicit request: RequestHeader)
<link href="@routes.Assets.versioned("styles/blast-visualization.css")" rel="stylesheet">


<a type="button" class="button success tiny hhpred_extra_button" data-open="forwardModal">Forward selected</a>
<div class="colorOptsAlignment">
    <a onclick="toggleSelectAll()" type="button" id="selectAllSeq">Select all</a>
    <a onclick="toggleSelectTopTen()" type="button" id="selectTopTen">Select top ten</a>
    <a onclick='toggleAliColor_("letters")' type="button"><span id="letterColor">Color letters</span></a>
    <a onclick='toggleAliColor_("background")' type="button"><span id="backgroundColor">Color background</span></a>
    <hr id="line-element" colspan="4" class="horizontal-line">
</div>
<div id="alignmentResultView">
<form id="alignmentResult">
    <table class="unstriped">
        <tbody class="alignmentTBody">
        @for((alignment,index) <- {jsValue \ "alignment"}.as[List[JsArray]].zipWithIndex) {
            <tr class="header">
                <td ><input type="checkbox" name="templates" class="alignmentCheckbox" value='@{index+1}'></td>
                <td>
                    @{index+1}.
                    @{alignment{0} match {
                        case JsDefined(jsValue) => (alignment{0}).get.as[String]
                        }
                    }
                </td>
            </tr>
            <tr class="sequence">
                <td></td>
                <td>
                    @{alignment{1} match {
                        case JsDefined(jsValue) => Html(BlastVisualization.colorRegexReplacer((alignment{1}).get.as[String]))
                        }
                    }
                </td>
            </tr>
        }
            <tr><td><br/></td></tr>
            <tr><td><br/></td></tr>
        </tbody>
    </table>

</form>
</div>

<script>
        var checkbox = "alignmentCheckbox";
        var colorLettersBool = false;
        var colorBackgroundBool = false;
        var selectTopTenBool = false;
        var selectAllBool = false;
        var aas = $('span[class^="aa_"]'); // Have to use jQuery for that one

        // check first ten checkboxes by default
        $(document).ready(function () {
                selectTopTen(checkbox);
        });

        function toggleAliColor_(str){
            if(str == "letters" ){
                if(colorLettersBool)
                    toggleAliColor("");
                else
                    toggleAliColor("letters");
                this.colorLettersBool = !this.colorLettersBool;
            }
            if(str == "background"){
                if(colorBackgroundBool)
                    toggleAliColor("");
                else
                    toggleAliColor("background");
                this.colorBackgroundBool = !this.colorBackgroundBool;
            }
        }


        function forward_(tool){
                forward(tool, forwardData);
        }

        function toggleSelectAll(){
            $("#selectAllSeq").addClass( "colorToggle" );
            this.selectAllBool = !this.selectAllBool;
            if(selectAllBool) {
                selectAll(checkbox);
                $("#selectTopTen").removeClass( "colorToggle" );
                $("#selectAllSeq").addClass( "colorToggle" );
            }
            else {
                deselectAll(checkbox);
                $("#selectAllSeq").removeClass( "colorToggle" );
            }
        }
        function toggleSelectTopTen(){

            this.selectTopTenBool = !this.selectTopTenBool;
            if(selectTopTenBool) {
                selectTopTen(checkbox);
                $("#selectTopTen").addClass( "colorToggle" );
                $("#selectAllSeq").removeClass( "colorToggle" );
            }
            else {
                deselectAll(checkbox);
                $("#selectTopTen").removeClass( "colorToggle" );
            }

        }


</script>